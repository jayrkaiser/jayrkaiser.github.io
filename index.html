<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>BadDuck Gang Manager</title>
<style>
/* ===== Cute Pastel Theme (mobile-first) ===== */
:root{
  --bg:#fffaf5; --card:#ffffff; --soft:#ffe7ef;
  --text:#563a32; --muted:#9a7a71;
  --prim:#ff9bb5; --accent:#ffd38d; --ok:#3fb984; --warn:#ffb84d; --danger:#ff6b6b;
  --bd:1px solid rgba(0,0,0,.08); --shadow:0 8px 24px rgba(0,0,0,.06);
}
*{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,'Segoe UI',Roboto,'Noto Sans Thai',sans-serif}
.appbar{position:sticky;top:0;display:flex;align-items:center;justify-content:space-between;padding:12px 14px;background:linear-gradient(90deg,#ffc3d2,#ffe0b8);box-shadow:var(--shadow)}
.appbar b{letter-spacing:.2px}
.icon{border:0;background:transparent;padding:6px;border-radius:10px}
.icon:active{transform:scale(.98)}
.container{padding:14px}
.tabs{position:fixed;left:0;right:0;bottom:0;display:grid;grid-template-columns:repeat(5,1fr);gap:4px;background:var(--card);box-shadow:var(--shadow);padding:6px 6px env(safe-area-inset-bottom)}
.tabs button{border:0;background:transparent;padding:10px 6px;border-radius:10px;color:var(--muted);font-weight:600}
.tabs button.active{background:var(--soft);color:var(--text)}
.view{display:none;padding:8px 0 86px}
.view.active{display:block}
.card{background:var(--card);border:var(--bd);border-radius:16px;padding:14px;box-shadow:var(--shadow);margin-bottom:12px}
.h{font-weight:800;margin:6px 0 10px}
.small{color:var(--muted);font-size:.9rem}
.row{display:grid;gap:8px}
.grid2{grid-template-columns:1fr 1fr}
input,textarea,select{width:100%;padding:10px 12px;border-radius:12px;border:var(--bd);background:#fff}
.btn{border:0;border-radius:12px;padding:10px 12px;font-weight:700}
.btn-primary{background:var(--prim);color:#fff}
.btn-soft{background:var(--soft)}
.btn-danger{background:var(--danger);color:#fff}
.list{list-style:none;margin:0;padding:0}
.item{display:flex;justify-content:space-between;gap:10px;padding:10px 12px;border-bottom:var(--bd)}
.badge{padding:4px 10px;border-radius:999px;background:#f3f4f6}
.badge.ok{background:#e8fff3;color:#0f5132}
.badge.warn{background:#fff4e0;color:#7a4d00}
.badge.danger{background:#ffe8ea;color:#8a2330}
.fab{position:fixed;right:16px;bottom:78px;width:56px;height:56px;border-radius:50%;border:0;background:var(--accent);box-shadow:var(--shadow);font-size:22px;font-weight:900;color:#4b2d1b}
.kv{display:grid;grid-template-columns:1fr auto;gap:8px}
code.inline{background:#fff;border:var(--bd);padding:2px 6px;border-radius:8px}
@media(min-width:720px){.container{max-width:920px;margin:0 auto}}
</style>
</head>
<body>

<header class="appbar">
  <b>ü¶Ü BadDuck Family Manager</b>
  <div>
    <button class="icon" id="exportBtn" title="‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•">üì§</button>
    <button class="icon" id="importBtn" title="‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•">üì•</button>
    <button class="icon" id="resetBtn" title="‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•">‚Ü∫</button>
  </div>
</header>

<main class="container">
  <!-- Dashboard -->
  <section id="v-dash" class="view active">
    <div class="card">
      <div class="h">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</div>
      <div class="row grid2">
        <div class="card">
          <div class="small">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
          <div id="statMembers" style="font-size:1.6rem;font-weight:800">0</div>
        </div>
        <div class="card">
          <div class="small">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏á‡∏Å‡∏•‡∏≤‡∏á</div>
          <div id="statBalance" style="font-size:1.6rem;font-weight:800">‡∏ø 0</div>
        </div>
      </div>
      <div class="small">‡∏£‡∏≠‡∏ö‡∏™‡πà‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: <span id="currentPeriod"></span> ¬∑ ‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏≤‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°: <span id="fineAbsent"></span>‡∏ø</div>
    </div>

    <div class="card">
      <div class="h">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</div>
      <ul class="list" id="nextActs"></ul>
    </div>
  </section>

  <!-- Members -->
  <section id="v-members" class="view">
    <div class="card">
      <div class="h">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</div>
      <div class="row grid2">
        <input id="mName" placeholder="‡∏ä‡∏∑‡πà‡∏≠">
        <select id="mHouse">
          <option value="">‡∏ö‡πâ‡∏≤‡∏ô (‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏)</option>
          <option>‡∏ö‡πâ‡∏≤‡∏ô A</option><option>‡∏ö‡πâ‡∏≤‡∏ô B</option><option>‡∏ö‡πâ‡∏≤‡∏ô C</option>
        </select>
      </div>
      <div class="row grid2">
        <input id="mDiscord" placeholder="Discord ID (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)">
        <select id="mRole"><option value="member">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</option><option value="leader">‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô</option><option value="admin">‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</option></select>
      </div>
      <button class="btn btn-primary" id="addMember">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
    </div>

    <div class="card">
      <div class="kv"><div class="h">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</div><div class="small"><span class="badge" id="memberCount">0</span></div></div>
      <ul class="list" id="memberList"></ul>
    </div>
  </section>

  <!-- Activities -->
  <section id="v-acts" class="view">
    <div class="card">
      <div class="h">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</div>
      <div class="row grid2">
        <input id="aName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°">
        <input id="aTime" type="datetime-local">
      </div>
      <label class="small"><input type="checkbox" id="aRequired" checked> ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° (‡πÑ‡∏°‡πà‡∏°‡∏≤‡πÇ‡∏î‡∏ô‡∏õ‡∏£‡∏±‡∏ö)</label>
      <button class="btn btn-primary" id="addAct">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</button>
    </div>

    <div class="card">
      <div class="h">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ + ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</div>
      <ul class="list" id="actList"></ul>
    </div>
  </section>

  <!-- Finance -->
  <section id="v-fin" class="view">
    <div class="card">
      <div class="h">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</div>
      <div class="row grid2">
        <input id="fDesc" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡πà‡∏≤‡∏ö‡πâ‡∏≤‡∏ô / ‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ)">
        <input id="fAmount" type="number" step="0.01" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (+/-)">
      </div>
      <select id="fMember"></select>
      <button class="btn btn-primary" id="addFin">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    </div>

    <div class="card">
      <div class="kv"><div class="h">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div><div class="small">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: <b id="finBalance">‡∏ø 0</b></div></div>
      <ul class="list" id="finList"></ul>
    </div>
  </section>

  <!-- Leave -->
  <section id="v-leave" class="view">
    <div class="card">
      <div class="h">‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏•‡∏≤</div>
      <select id="lMember"></select>
      <div class="row"><textarea id="lReason" rows="3" placeholder="‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤"></textarea></div>
      <button class="btn btn-primary" id="addLeave">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠</button>
    </div>

    <div class="card">
      <div class="h">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏Ç‡∏≠</div>
      <ul class="list" id="leaveList"></ul>
    </div>
  </section>

  <!-- Settings -->
  <section id="v-settings" class="view">
    <div class="card">
      <div class="h">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</div>
      <div class="row grid2">
        <div><div class="small">‡∏£‡∏≠‡∏ö‡∏™‡πà‡∏á‡πÄ‡∏á‡∏¥‡∏ô (YYYY-MM)</div><input id="sPeriod" placeholder="2025-10"></div>
        <div><div class="small">‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏≤‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°/‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡∏ø)</div><input id="sFineAbsent" type="number" value="50"></div>
      </div>
      <button class="btn btn-primary" id="saveSettings">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
      <div class="small">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏£‡∏∏‡πà‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πÅ‡∏ï‡∏ï‡∏¥‡∏Å ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô <code class="inline">localStorage</code></div>
    </div>
  </section>
</main>

<!-- Bottom Tabs -->
<nav class="tabs" role="tablist">
  <button data-target="v-dash" class="active">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</button>
  <button data-target="v-members">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
  <button data-target="v-acts">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</button>
  <button data-target="v-fin">‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</button>
  <button data-target="v-leave">‡∏•‡∏≤</button>
  <button data-target="v-settings">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
</nav>

<button class="fab" id="quickAdd" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏£‡πá‡∏ß">Ôºã</button>

<script>
/* ===== Simple store (localStorage) ===== */
const empty = { members:[], acts:[], attend:[], ledger:[], leaves:[], settings:{ period:ym(), fineAbsent:50 } };
let db = load();

function load(){ try{ return JSON.parse(localStorage.getItem('bd_gang')) || structuredClone(empty);}catch(e){return structuredClone(empty);} }
function save(){ localStorage.setItem('bd_gang', JSON.stringify(db)); renderAll(); }

/* ===== Helpers ===== */
function ym(d=new Date()){ return d.toISOString().slice(0,7); }
const $ = s=>document.querySelector(s);
const $$ = s=>document.querySelectorAll(s);

/* ===== Tabs ===== */
$$('.tabs button').forEach(btn=>{
  btn.onclick=()=>{ $$('.tabs button').forEach(b=>b.classList.remove('active')); btn.classList.add('active');
    $$('.view').forEach(v=>v.classList.remove('active')); $('#'+btn.dataset.target).classList.add('active'); window.scrollTo({top:0,behavior:'smooth'});
  };
});

/* ===== Actions: Members ===== */
$('#addMember').onclick=()=>{
  const name=$('#mName').value.trim(); const house=$('#mHouse').value; const discord=$('#mDiscord').value.trim(); const role=$('#mRole').value;
  if(!name) return alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å');
  const id=crypto.randomUUID();
  db.members.push({id,name,house,discord,role,createdAt:Date.now()});
  $('#mName').value=''; $('#mDiscord').value=''; save();
};
function removeMember(id){
  if(!confirm('‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ô‡∏µ‡πâ?')) return;
  db.members=db.members.filter(m=>m.id!==id);
  db.ledger=db.ledger.filter(x=>x.userId!==id);
  db.attend=db.attend.filter(x=>x.userId!==id);
  db.leaves=db.leaves.filter(x=>x.userId!==id);
  save();
}

/* ===== Activities & Attendance ===== */
$('#addAct').onclick=()=>{
  const name=$('#aName').value.trim(); const ts=$('#aTime').value; const req=$('#aRequired').checked;
  if(!name||!ts) return alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤');
  const id=crypto.randomUUID();
  db.acts.push({id,name,at:ts,required:req});
  $('#aName').value=''; $('#aTime').value=''; save();
};
function markAttendance(actId,userId,status){
  const key = db.attend.find(a=>a.actId===actId && a.userId===userId);
  if(key){ key.status=status; } else { db.attend.push({id:crypto.randomUUID(),actId,userId,status,at:Date.now()}); }
  // Auto fine on ABSENT if required
  const act=db.acts.find(a=>a.id===actId);
  if(status==='absent' && act?.required){
    const amount=Number(db.settings.fineAbsent||50);
    db.ledger.push({id:crypto.randomUUID(),type:'fine',userId,amount:-Math.abs(amount),memo:`‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° ${act.name}`,at:Date.now()});
  }
  save();
}

/* ===== Finance ===== */
$('#addFin').onclick=()=>{
  const desc=$('#fDesc').value.trim(); const amt=parseFloat($('#fAmount').value); const uid=$('#fMember').value||null;
  if(!desc || isNaN(amt)) return alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô');
  db.ledger.push({id:crypto.randomUUID(),type:amt>=0?'income':'expense',userId:uid,amount:amt,memo:desc,at:Date.now(),period:db.settings.period});
  $('#fDesc').value=''; $('#fAmount').value=''; save();
};

/* ===== Leave ===== */
$('#addLeave').onclick=()=>{
  const uid=$('#lMember').value; const reason=$('#lReason').value.trim();
  if(!uid||!reason) return alert('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÅ‡∏•‡∏∞‡πÉ‡∏™‡πà‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•');
  db.leaves.push({id:crypto.randomUUID(),userId:uid,reason,status:'pending',at:Date.now()});
  $('#lReason').value=''; save();
};

/* ===== Settings ===== */
$('#saveSettings').onclick=()=>{
  db.settings.period=$('#sPeriod').value||ym();
  db.settings.fineAbsent=Number($('#sFineAbsent').value||50);
  save();
};

/* ===== Export / Import / Reset ===== */
$('#exportBtn').onclick=()=>{
  const blob=new Blob([JSON.stringify(db,null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='badduck_backup.json'; a.click();
};
$('#importBtn').onclick=async()=>{
  const i=document.createElement('input'); i.type='file'; i.accept='application/json';
  i.onchange=async()=>{ const f=i.files[0]; if(!f) return;
    const t=await f.text(); try{ db=JSON.parse(t); save(); alert('‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß'); }catch(e){ alert('‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); }
  }; i.click();
};
$('#resetBtn').onclick=()=>{
  if(confirm('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')){ db=structuredClone(empty); save(); }
};

/* ===== Render ===== */
function renderMembers(){
  $('#memberCount').textContent=db.members.length;
  const list=db.members.map(m=>`<li class="item"><div><b>${m.name}</b><div class="small">${m.house||'‚Äî'} ¬∑ ${m.role}${m.discord?` ¬∑ DC:${m.discord}`:''}</div></div><div><button class="btn btn-soft" onclick="removeMember('${m.id}')">‡∏•‡∏ö</button></div></li>`).join('') || '<div class="small">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</div>';
  $('#memberList').innerHTML=list;
  // selects
  const opts = '<option value="">(‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏)</option>'+ db.members.map(m=>`<option value="${m.id}">${m.name}</option>`).join('');
  $('#fMember').innerHTML=opts; $('#lMember').innerHTML=opts;
}
function renderActs(){
  const byTime=[...db.acts].sort((a,b)=>a.at.localeCompare(b.at));
  $('#actList').innerHTML = byTime.map(a=>{
    const rows=db.members.map(m=>{
      const rec=db.attend.find(x=>x.actId===a.id && x.userId===m.id)?.status||'-';
      const chip = rec==='present' ? 'ok' : rec==='late' ? 'warn' : rec==='absent' ? 'danger' : '';
      return `<div class="item"><div>${m.name}</div><div class="small"><span class="badge ${chip}">${rec}</span></div>
      <div>
        <button class="btn btn-soft" onclick="markAttendance('${a.id}','${m.id}','present')">‡∏°‡∏≤</button>
        <button class="btn btn-soft" onclick="markAttendance('${a.id}','${m.id}','late')">‡∏™‡∏≤‡∏¢</button>
        <button class="btn btn-soft" onclick="markAttendance('${a.id}','${m.id}','absent')">‡∏Ç‡∏≤‡∏î</button>
      </div></div>`;
    }).join('');
    return `<li class="card"><div class="kv"><div><b>${a.name}</b><div class="small">${a.at.replace('T',' ')}</div></div><div>${a.required?'<span class="badge warn">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö</span>':''}</div></div>${rows}</li>`;
  }).join('') || '<div class="small">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</div>';

  // next on dashboard
  $('#nextActs').innerHTML = byTime.slice(0,3).map(a=>`<li class="item"><div><b>${a.name}</b><div class="small">${a.at.replace('T',' ')}</div></div><div>${a.required?'<span class="badge warn">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö</span>':''}</div></li>`).join('') || '<div class="small">‚Äî</div>';
}
function renderFinance(){
  const rows = db.ledger.map(x=>{
    const sign = x.amount>=0? 'ok':'danger';
    const who = x.userId ? (db.members.find(m=>m.id===x.userId)?.name || '‚Äî') : '‚Äî';
    return `<li class="item"><div><b>${x.memo}</b><div class="small">${new Date(x.at).toLocaleString()} ¬∑ ${who}</div></div><div class="badge ${sign}">${x.amount>=0?'+':''}${x.amount}</div></li>`;
  }).join('') || '<div class="small">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>';
  $('#finList').innerHTML=rows;
  const bal = db.ledger.reduce((s,x)=>s+Number(x.amount||0),0);
  $('#finBalance').textContent='‡∏ø '+bal.toFixed(2);
  $('#statBalance').textContent='‡∏ø '+bal.toFixed(2);
}
function renderLeaves(){
  $('#leaveList').innerHTML = db.leaves.map(l=>{
    const name=db.members.find(m=>m.id===l.userId)?.name||'‚Äî';
    return `<li class="item"><div><b>${name}</b><div class="small">${l.reason}</div></div><div class="badge">${l.status}</div></li>`;
  }).join('') || '<div class="small">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠</div>';
}
function renderSettings(){
  $('#sPeriod').value=db.settings.period||ym();
  $('#sFineAbsent').value=db.settings.fineAbsent||50;
  $('#currentPeriod').textContent=db.settings.period||ym();
  $('#fineAbsent').textContent=db.settings.fineAbsent||50;
}
function renderAll(){ renderMembers(); renderActs(); renderFinance(); renderLeaves(); renderSettings(); $('#statMembers').textContent=db.members.length; }
renderAll();

/* ===== Quick Add FAB: ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å/‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ï‡∏≤‡∏°‡πÅ‡∏ó‡πá‡∏ö ===== */
$('#quickAdd').onclick=()=>{
  if($('#v-members').classList.contains('active')) $('#mName').focus();
  else if($('#v-acts').classList.contains('active')) $('#aName').focus();
  else if($('#v-fin').classList.contains('active')) $('#fDesc').focus();
  else if($('#v-leave').classList.contains('active')) $('#lReason').focus();
  else { $$('.tabs button')[1].click(); $('#mName').focus(); }
};
</script>
</body>
</html>
